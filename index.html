<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Christmas Stars for Cún</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background-color: #010205;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        /* ===== SAO NHẤP NHÁY (THEO GỢI Ý) ===== */
        .star {
            position: fixed;
            width: 2px;
            height: 2px;
            background: white;
            border-radius: 50%;
            opacity: 0.8;
            z-index: 0;
            animation: twinkle 2s infinite ease-in-out;
            pointer-events: none;
        }
        @keyframes twinkle {
            0%, 100% { opacity: 0.2; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.2); }
        }

        /* ===== TUYẾT RƠI (KÍCH THƯỚC NHỎ) ===== */
        .snowflake {
            position: fixed;
            top: -20px;
            color: white;
            pointer-events: none;
            user-select: none;
            z-index: 1000;
            animation: fall linear forwards;
            opacity: 0.6;
        }
        @keyframes fall {
            to { transform: translateY(110vh); }
        }

        /* ===== DÒNG CHỮ DƯỚI ĐÁY ===== */
        #overlay {
            position: absolute;
            bottom: 30px;
            width: 100%;
            text-align: center;
            color: #ffd700;
            letter-spacing: 4px;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
            z-index: 10;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        #overlay:hover {
            transform: scale(1.1);
            text-shadow: 0 0 25px rgba(255, 215, 0, 0.9);
        }

        /* ===== LÁ THƯ PHÁT SÁNG ===== */
        #letter {
            z-index: 9999;
            pointer-events: auto;
            display: none;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(145deg, #fffdf5, #ffeecb);
            padding: 32px;
            width: 320px;
            border-radius: 24px;
            border: 2px solid #eadc8d;
            box-shadow: 
                0 0 30px rgba(255, 241, 159, 0.8),
                0 0 60px rgba(255, 215, 0, 0.3),
                inset 0 0 15px rgba(255, 255, 255, 1);
            text-align: center;
            animation: letterIn 0.7s cubic-bezier(.17, .89, .32, 1.49);
        }

        @keyframes letterIn {
            from { transform: translate(-50%, -10%) scale(0.4); opacity: 0; }
            to { transform: translate(-50%, -50%) scale(1); opacity: 1; }
        }

        .letter-icons {
            display: flex;
            justify-content: space-between;
            font-size: 1.5rem;
            margin-bottom: 10px;
        }

        .message {
            font-family: 'Georgia', serif;
            font-size: 1.8rem;
            font-weight: bold;
            color: #d42424;
            margin: 10px 0;
        }

        .sub-text {
            font-size: 1rem;
            line-height: 1.6;
            color: #4a3b2a;
            margin: 15px 0;
            font-style: italic;
        }

        #closeLetterBtn {
            position: absolute;
            top: 10px;
            right: 15px;
            background: none;
            border: none;
            font-size: 1.2rem;
            color: #a6926d;
            cursor: pointer;
            font-weight: bold;
        }

        #modal-backdrop {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8);
            display: none;
            z-index: 9998;
            backdrop-filter: blur(5px);
        }
    </style>
</head>
<body>

    <div id="modal-backdrop"></div>
    
    <!-- LÁ THƯ -->
    <div id="letter">
        <p class="message">Merry Christmas</p>
        <p class="sub-text">
            Chúc Cún giáng sinh an lành, hạnh phúc,
            luôn nở nụ cười, và kèm theo những điều
            may mắn, tốt đẹp sẽ đến với em nhaa. ✨
        </p>
        <p class="sub-text" style="font-weight: bold; color: #d42424;">
            Love uuuu ❤️
        </p>
        <button id="closeLetterBtn">x</button>
    </div>

    <div id="overlay">
        <h2>MERRY CHRISTMAS ✉️</h2>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

    <script>
        // --- TẠO SAO (THEO GỢI Ý) ---
        function initStars() {
            for (let i = 0; i < 100; i++) {
                const star = document.createElement("div");
                star.className = "star";
                star.style.left = Math.random() * window.innerWidth + "px";
                star.style.top = Math.random() * window.innerHeight + "px";
                star.style.animationDelay = Math.random() * 2 + "s";
                document.body.appendChild(star);
            }
        }

        // --- TUYẾT RƠI ---
        function createSnowflake() {
            const snow = document.createElement("div");
            snow.className = "snowflake";
            snow.textContent = "❄";
            snow.style.left = Math.random() * window.innerWidth + "px";
            snow.style.fontSize = Math.random() * 6 + 5 + "px";
            snow.style.animationDuration = Math.random() * 5 + 5 + "s";
            document.body.appendChild(snow);
            setTimeout(() => snow.remove(), 8000);
        }
        setInterval(createSnowflake, 200);

        // --- TƯƠNG TÁC LÁ THƯ ---
        const overlay = document.getElementById('overlay');
        const letter = document.getElementById('letter');
        const backdrop = document.getElementById('modal-backdrop');
        const closeBtn = document.getElementById('closeLetterBtn');

        overlay.addEventListener('click', () => {
            letter.style.display = 'block';
            backdrop.style.display = 'block';
        });

        const closeLetter = () => {
            letter.style.display = 'none';
            backdrop.style.display = 'none';
        };
        closeBtn.addEventListener('click', closeLetter);
        backdrop.addEventListener('click', closeLetter);

        // --- THREE.JS TREE ---
        let scene, camera, renderer, spiralPoints, starTop;
        let mouseX = 0, mouseY = 0;
        let windowHalfX = window.innerWidth / 2;
        let windowHalfY = window.innerHeight / 2;

        let drawProgress = 0;
        const totalPoints = 25000;
        const treeHeight = 750;
        const baseRadius = 300;
        const spiralTurns = 25;

        function initTree() {
            scene = new THREE.Scene();
            scene.fog = new THREE.FogExp2(0x010205, 0.0006);

            camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 1, 5000);
            camera.position.set(0, 200, 1100);

            const geometry = new THREE.BufferGeometry();
            const positions = [];
            const colors = [];

            for (let i = 0; i < totalPoints; i++) {
                const ratio = i / totalPoints;
                const angle = ratio * Math.PI * 2 * spiralTurns;
                const y = (ratio * treeHeight) - (treeHeight / 2);
                const radius = baseRadius * (1 - ratio);
                const spread = 25 * (1 - ratio); 
                positions.push(Math.cos(angle) * radius + (Math.random()-0.5)*spread, y, Math.sin(angle) * radius + (Math.random()-0.5)*spread);

                const color = new THREE.Color();
                const rand = Math.random();
                if (rand > 0.8) color.setHex(0xfff5e6);
                else if (rand > 0.4) color.setHex(0xffd700);
                else color.setHex(0x228b22);
                colors.push(color.r, color.g, color.b);
            }

            geometry.setAttribute('position', new THREE.Float32BufferAttribute(positions, 3));
            geometry.setAttribute('color', new THREE.Float32BufferAttribute(colors, 3));
            geometry.setDrawRange(0, 0);

            spiralPoints = new THREE.Points(geometry, new THREE.PointsMaterial({
                size: 3, vertexColors: true, transparent: true, opacity: 0.8, blending: THREE.AdditiveBlending
            }));
            scene.add(spiralPoints);

            // Ngôi sao trên đỉnh
            const starGeom = new THREE.BufferGeometry();
            const starPos = [];
            for (let i = 0; i < 1500; i++) {
                const angle = Math.random() * Math.PI * 2;
                const r = (Math.floor((angle * 5) / (Math.PI * 2) * 2) % 2 === 0) ? 65 : 20;
                starPos.push(Math.cos(angle)*r*Math.random(), (treeHeight/2)+50 + Math.sin(angle)*r*Math.random(), (Math.random()-0.5)*20);
            }
            starGeom.setAttribute('position', new THREE.Float32BufferAttribute(starPos, 3));
            starTop = new THREE.Points(starGeom, new THREE.PointsMaterial({color: 0xffff00, size: 2, transparent: true, opacity: 0, blending: THREE.AdditiveBlending}));
            scene.add(starTop);

            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setPixelRatio(window.devicePixelRatio);
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.body.appendChild(renderer.domElement);

            window.addEventListener('resize', () => {
                windowHalfX = window.innerWidth / 2; windowHalfY = window.innerHeight / 2;
                camera.aspect = window.innerWidth / window.innerHeight; camera.updateProjectionMatrix();
                renderer.setSize(window.innerWidth, window.innerHeight);
            });
            document.addEventListener('mousemove', (e) => {
                mouseX = e.clientX - windowHalfX; mouseY = e.clientY - windowHalfY;
            });
        }

        function animate() {
            requestAnimationFrame(animate);
            const time = Date.now() * 0.001;
            if (drawProgress < 1) {
                drawProgress += 0.001;
                spiralPoints.geometry.setDrawRange(0, Math.floor(drawProgress * totalPoints));
            } else {
                if (starTop.material.opacity < 1) starTop.material.opacity += 0.02;
            }
            spiralPoints.rotation.y += 0.005;
            starTop.rotation.y += 0.01;
            camera.position.x += (mouseX * 0.6 - camera.position.x) * 0.05;
            camera.position.y += (-mouseY * 0.6 - camera.position.y) * 0.05;
            camera.lookAt(0, 0, 0);
            spiralPoints.material.size = 2.5 + Math.sin(time * 4) * 1.5;
            renderer.render(scene, camera);
        }

        initStars();
        initTree();
        animate();
    </script>
</body>
</html>
